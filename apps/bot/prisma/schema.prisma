datasource database {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum FeatureFlags {
  UNDEFINED
  DEV
  BETA
}

model Blacklist {
  guildId String @id @unique
}

model EventSettings {
  guildId       String         @id @unique
  enabled       Boolean        @default(false)
  coreSettings  CoreSettings   @relation(fields: [guildId], references: [guildId], onDelete: Cascade)
}

model ModerationSettings {
  guildId              String       @id @unique
  enabled              Boolean      @default(false)
  reportChannelId      String?
  minAccountAgeEnabled Boolean      @default(false)
  minAccountAgeReq     Int?
  minAccountAgeMsg     String?
  antiHoistEnabled     Boolean      @default(false)
  coreSettings         CoreSettings @relation(fields: [guildId], references: [guildId], onDelete: Cascade)
}

model Poll {
  id              String          @unique
  title           String
  channelId       String
  creator         String
  time            BigInt?
  options         String[]
  createdAt       DateTime        @default(now())
  guildId         String
  utilitySettings UtilitySettings @relation(fields: [guildId], references: [guildId], onDelete: Cascade)

  @@id([id, guildId])
}

model UtilitySettings {
  guildId           String       @id @unique
  enabled           Boolean      @default(false)
  incidentChannelId String?      @unique
  creditsChannelId  String?
  polls             Poll[]
  coreSettings      CoreSettings @relation(fields: [guildId], references: [guildId], onDelete: Cascade)
}

model WelcomeSettings {
  guildId      String       @id @unique
  enabled      Boolean      @default(false)
  channelId    String?
  message      String?
  title        String?
  description  String?
  image        String?
  color        String?
  coreSettings CoreSettings @relation(fields: [guildId], references: [guildId], onDelete: Cascade)
}

model YoutubeSubscription {
  id                     String          @default(uuid()) @database.Uuid
  message                String?
  roleId                 String?
  discordChannelId       String?
  memberRoleId           String?
  memberDiscordChannelId String?
  channelId              String
  guildId                String
  
  @@id([id])
  @@unique([channelId, guildId])
}

model CoreSettings {
  guildId            String              @id @unique
  flags              FeatureFlags[]
  eventSettings      EventSettings?
  moderationSettings ModerationSettings?
  utilitySettings    UtilitySettings?
  welcomeSettings    WelcomeSettings?
}

model IncidentMessage {
  id         String          @unique
  channelId  String
  guildId    String
  incidentId String          @unique
  incident   DiscordIncident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
}

model DiscordIncident {
  id        String            @id @unique
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  resolved  Boolean
  messages  IncidentMessage[]
}